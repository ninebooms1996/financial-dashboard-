<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Financial Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f9fafb; }
    h1 { color: #065f46; }
    .card { background: #fff; padding: 16px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .grid { display: grid; gap: 16px; }
    .grid-2 { grid-template-columns: 1fr 1fr; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 8px; border-bottom: 1px solid #ddd; text-align: left; }
    th { background: #f3f4f6; }
    button { padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc; background: #fff; cursor: pointer; }
    button:hover { background: #f3f4f6; }
    .income { color: green; }
    .expense { color: red; }
    .cost { color: orange; }
  </style>
</head>
<body>
  <h1>บันทึกรายรับ – รายจ่ายบริษัท</h1>

  <div class="card">
    <h2>เพิ่มรายการ</h2>
    <form id="txForm">
      <label>วันที่: <input type="date" id="date" required></label>
      <label> ประเภท: 
        <select id="type">
          <option value="income">รายรับ</option>
          <option value="expense">รายจ่าย</option>
          <option value="cost">ต้นทุน</option>
        </select>
      </label>
      <label> จำนวนเงิน: <input type="number" id="amount" required></label>
      <label> หมวดหมู่: <input type="text" id="category"></label>
      <label> หมายเหตุ: <input type="text" id="note"></label>
      <button type="submit">บันทึก</button>
    </form>
  </div>

  <div class="card grid grid-2">
    <canvas id="barChart"></canvas>
    <canvas id="lineChart"></canvas>
  </div>

  <div class="card">
    <h2>รายการทั้งหมด</h2>
    <table id="txTable">
      <thead>
        <tr>
          <th>วันที่</th><th>ประเภท</th><th>หมวดหมู่</th><th>หมายเหตุ</th><th>จำนวนเงิน</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyC1--Ek-zl4wx5yOa7rvkNhldKWG7hIjjo",
  authDomain: "financial-dashboard-3d5dc.firebaseapp.com",
  projectId: "financial-dashboard-3d5dc",
  storageBucket: "financial-dashboard-3d5dc.firebasestorage.app",
  messagingSenderId: "308051512266",
  appId: "1:308051512266:web:55e25fbd660bac950c5d33",
  measurementId: "G-BNRMXZZBC0"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- Data Handling ---
const txForm = document.getElementById("txForm");
const txTableBody = document.querySelector("#txTable tbody");
let transactions = [];

// Add Transaction
 txForm.addEventListener("submit", async (e)=>{
  e.preventDefault();
  const tx = {
    date: document.getElementById("date").value,
    type: document.getElementById("type").value,
    amount: parseFloat(document.getElementById("amount").value),
    category: document.getElementById("category").value,
    note: document.getElementById("note").value
  };
  await db.collection("transactions").add(tx);
  txForm.reset();
});

// Realtime listener
 db.collection("transactions").orderBy("date").onSnapshot(snapshot =>{
  transactions = [];
  snapshot.forEach(doc =>{
    transactions.push(doc.data());
  });
  renderTable();
  renderCharts();
});

function renderTable(){
  txTableBody.innerHTML = "";
  transactions.forEach(t =>{
    const row = `<tr>
      <td>${t.date}</td>
      <td class="${t.type}">${t.type}</td>
      <td>${t.category}</td>
      <td>${t.note}</td>
      <td>${t.amount.toLocaleString()}</td>
    </tr>`;
    txTableBody.innerHTML += row;
  });
}

let barChart, lineChart;
function renderCharts(){
  const income = {}, expense = {}, cost = {};
  transactions.forEach(t=>{
    if(!income[t.date]){ income[t.date]=0; expense[t.date]=0; cost[t.date]=0; }
    if(t.type==="income") income[t.date]+=t.amount;
    if(t.type==="expense") expense[t.date]+=t.amount;
    if(t.type==="cost") cost[t.date]+=t.amount;
  });
  const labels = Object.keys(income);
  const incomeData = labels.map(l=>income[l]);
  const expenseData = labels.map(l=>expense[l]);
  const costData = labels.map(l=>cost[l]);

  if(barChart) barChart.destroy();
  if(lineChart) lineChart.destroy();

  barChart = new Chart(document.getElementById("barChart"), {
    type: 'bar',
    data: { labels, datasets: [
      { label:"รายรับ", data: incomeData, backgroundColor:"green" },
      { label:"รายจ่าย", data: expenseData, backgroundColor:"red" },
      { label:"ต้นทุน", data: costData, backgroundColor:"orange" }
    ]}
  });

  lineChart = new Chart(document.getElementById("lineChart"), {
    type: 'line',
    data: { labels, datasets: [
      { label:"รายรับ", data: incomeData, borderColor:"green", fill:false },
      { label:"รายจ่าย", data: expenseData, borderColor:"red", fill:false },
      { label:"ต้นทุน", data: costData, borderColor:"orange", fill:false }
    ]}
  });
}
</script>
</body>
</html>
